cd /usr/users/celldev/luf/test/atac/5.less




sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T25-1/T25-1_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/T25-1/T25-1_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T25-2/T25-2_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/T25-2/T25-2_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T25-3/T25-3_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/T25-3/T25-3_peaks.sorted.narrowPeak
#sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T25/T25_peaks.broadPeak > /usr/users/celldev/luf/test/atac/4.macs2/T25/T25_peaks.sorted.broadPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T25/T25_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/T25/T25_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T5-1/T5-1_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/T5-1/T5-1_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T5-2/T5-2_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/T5-2/T5-2_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T5-3/T5-3_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/T5-3/T5-3_peaks.sorted.narrowPeak
#sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T5/T5_peaks.broadPeak > /usr/users/celldev/luf/test/atac/4.macs2/T5/T5_peaks.sorted.broadPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/T5/T5_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/T5/T5_peaks.sorted.narrowPeak
#sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/Tauschii/Tauschii_peaks.broadPeak > /usr/users/celldev/luf/test/atac/4.macs2/Tauschii/Tauschii_peaks.sorted.broadPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/Tauschii/Tauschii_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/Tauschii/Tauschii_peaks.sorted.narrowPeak

sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P25-1/P25-1_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/P25-1/P25-1_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P25-2/P25-2_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/P25-2/P25-2_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P25-3/P25-3_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/P25-3/P25-3_peaks.sorted.narrowPeak
#sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P25/P25_peaks.broadPeak > /usr/users/celldev/luf/test/atac/4.macs2/P25/P25_peaks.sorted.broadPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P25/P25_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/P25/P25_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P5-1/P5-1_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/P5-1/P5-1_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P5-2/P5-2_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/P5-2/P5-2_peaks.sorted.narrowPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P5-3/P5-3_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/P5-3/P5-3_peaks.sorted.narrowPeak
#sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P5/P5_peaks.broadPeak > /usr/users/celldev/luf/test/atac/4.macs2/P5/P5_peaks.sorted.broadPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/P5/P5_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/P5/P5_peaks.sorted.narrowPeak
#sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/Paragon/Paragon_peaks.broadPeak > /usr/users/celldev/luf/test/atac/4.macs2/Paragon/Paragon_peaks.sorted.broadPeak
sort -k1,1V -k2,2n -k3,3n /usr/users/celldev/luf/test/atac/4.macs2/Paragon/Paragon_peaks.narrowPeak > /usr/users/celldev/luf/test/atac/4.macs2/Paragon/Paragon_peaks.sorted.narrowPeak

:<<SORTEDPEAKS
/usr/users/celldev/luf/test/atac/4.macs2/P25-1/P25-1_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/P25-2/P25-2_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/P25-3/P25-3_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/P25/P25_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/P5-1/P5-1_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/P5-2/P5-2_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/P5-3/P5-3_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/P5/P5_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/Paragon/Paragon_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/T25-1/T25-1_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/T25-2/T25-2_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/T25-3/T25-3_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/T25/T25_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/T5-1/T5-1_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/T5-2/T5-2_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/T5-3/T5-3_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/T5/T5_peaks.sorted.narrowPeak
/usr/users/celldev/luf/test/atac/4.macs2/Tauschii/Tauschii_peaks.sorted.narrowPeak
SORTEDPEAKS

###Not working as scaffold names
:<<EOM1
OutPrefix="P25"
bedSumfile=/usr/users/celldev/luf/test/atac/4.macs2/P25/P25_peaks.sorted.broadPeak
bedRep1file=/usr/users/celldev/luf/test/atac/4.macs2/P25-1/P25-1_peaks.sorted.narrowPeak
bedRep2file=/usr/users/celldev/luf/test/atac/4.macs2/P25-2/P25-2_peaks.sorted.narrowPeak
bedRep3file=/usr/users/celldev/luf/test/atac/4.macs2/P25-3/P25-3_peaks.sorted.narrowPeak
bedOut=$OutPrefix.consensus.bed
bedOut=temp1.bed
bedtools intersect -a $bedSumfile -b $bedRep1file -u -wa -sorted -nonamecheck > $bedOut
bedTemp1file=$bedOut
bedOut=temp2.bed
bedtools intersect -a $bedTemp1file -b $bedRep2file -u -wa -sorted -nonamecheck > $bedOut
bedTemp2file=$bedOut
bedtools intersect -a $bedTemp2file -b $bedRep3file -u -wa -sorted -nonamecheck > $bedOut
rm temp*
EOM1



###Call consensus
OutPrefix="P25"
SumBed=/usr/users/celldev/luf/test/atac/4.macs2/P25/P25_peaks.sorted.narrowPeak
Rep1Bed=/usr/users/celldev/luf/test/atac/4.macs2/P25-1/P25-1_peaks.sorted.narrowPeak
Rep2Bed=/usr/users/celldev/luf/test/atac/4.macs2/P25-2/P25-2_peaks.sorted.narrowPeak
Rep3Bed=/usr/users/celldev/luf/test/atac/4.macs2/P25-3/P25-3_peaks.sorted.narrowPeak
ls $SumBed $Rep1Bed $Rep2Bed $Rep3Bed


OutPrefix="P5"
Rep1Bed=/usr/users/celldev/luf/test/atac/4.macs2/P5-1/P5-1_peaks.sorted.narrowPeak
Rep2Bed=/usr/users/celldev/luf/test/atac/4.macs2/P5-2/P5-2_peaks.sorted.narrowPeak
Rep3Bed=/usr/users/celldev/luf/test/atac/4.macs2/P5-3/P5-3_peaks.sorted.narrowPeak
SumBed=/usr/users/celldev/luf/test/atac/4.macs2/P5/P5_peaks.sorted.narrowPeak
ls $SumBed $Rep1Bed $Rep2Bed $Rep3Bed

grep ^'chr' $SumBed > $OutPrefix.3DL.bed
grep ^'ctg' $SumBed > $OutPrefix.ctg.bed
grep -v ^'c' $SumBed > $OutPrefix.non3DL.bed
wc -l $SumBed $OutPrefix.3DL.bed $OutPrefix.ctg.bed $OutPrefix.non3DL.bed
grep ^'chr' $Rep1Bed > ${OutPrefix}-1.3DL.bed
grep ^'ctg' $Rep1Bed > ${OutPrefix}-1.ctg.bed
grep -v ^'c' $Rep1Bed > ${OutPrefix}-1.non3DL.bed
wc -l $Rep1Bed ${OutPrefix}-1.3DL.bed ${OutPrefix}-1.ctg.bed ${OutPrefix}-1.non3DL.bed
grep ^'chr' $Rep2Bed > ${OutPrefix}-2.3DL.bed
grep ^'ctg' $Rep2Bed > ${OutPrefix}-2.ctg.bed
grep -v ^'c' $Rep2Bed > ${OutPrefix}-2.non3DL.bed
wc -l $Rep2Bed ${OutPrefix}-2.3DL.bed ${OutPrefix}-2.ctg.bed ${OutPrefix}-2.non3DL.bed
grep ^'chr' $Rep3Bed > ${OutPrefix}-3.3DL.bed
grep ^'ctg' $Rep3Bed > ${OutPrefix}-3.ctg.bed
grep -v ^'c' $Rep3Bed > ${OutPrefix}-3.non3DL.bed
wc -l $Rep3Bed ${OutPrefix}-3.3DL.bed ${OutPrefix}-3.ctg.bed ${OutPrefix}-3.non3DL.bed
bedSumfile=$OutPrefix.non3DL.bed
bedRep1file=${OutPrefix}-1.non3DL.bed
bedRep2file=${OutPrefix}-2.non3DL.bed
bedRep3file=${OutPrefix}-3.non3DL.bed
bedConsensusOut=$OutPrefix.non3DL.consensus.bed
bedOut=temp1.bed
bedtools intersect -a $bedSumfile -b $bedRep1file -u -wa -sorted > $bedOut
bedTemp1file=$bedOut
bedOut=temp2.bed
bedtools intersect -a $bedTemp1file -b $bedRep2file -u -wa -sorted > $bedOut
bedTemp2file=$bedOut
bedtools intersect -a $bedTemp2file -b $bedRep3file -u -wa -sorted > $bedConsensusOut
rm temp*
bedSumfile=$OutPrefix.3DL.bed
bedRep1file=${OutPrefix}-1.3DL.bed
bedRep2file=${OutPrefix}-2.3DL.bed
bedRep3file=${OutPrefix}-3.3DL.bed
bedConsensusOut=$OutPrefix.3DL.consensus.bed
bedOut=temp3.bed
bedtools intersect -a $bedSumfile -b $bedRep1file -u -wa > $bedOut
bedTemp3file=$bedOut
bedOut=temp4.bed
bedtools intersect -a $bedTemp3file -b $bedRep2file -u -wa > $bedOut
bedTemp4file=$bedOut
bedtools intersect -a $bedTemp4file -b $bedRep3file -u -wa > $bedConsensusOut
rm temp*
bedSumfile=${OutPrefix}.ctg.bed
bedRep1file=${OutPrefix}-1.ctg.bed
bedRep2file=${OutPrefix}-2.ctg.bed
bedRep3file=${OutPrefix}-3.ctg.bed
bedConsensusOut=$OutPrefix.ctg.consensus.bed
bedOut=temp5.bed
bedtools intersect -a $bedSumfile -b $bedRep1file -u -wa > $bedOut
bedTemp5file=$bedOut
bedOut=temp6.bed
bedtools intersect -a $bedTemp5file -b $bedRep2file -u -wa > $bedOut
bedTemp6file=$bedOut
bedtools intersect -a $bedTemp6file -b $bedRep3file -u -wa > $bedConsensusOut
rm temp*

######check fragment size in peak region of paragin
:<<EOM2
OutPrefix="P5"
OutBase="${OutPrefix}-3"
pairbed=/usr/users/celldev/luf/test/atac/3.bampe/P5-3-B10_TKD180702140_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed
#P25-1-A2_TKD180702135_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed
#P25-2-A3_TKD180702136_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed
#P25-3-B4_TKD180702137_merge.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed
#/usr/users/celldev/luf/test/atac/3.bampe/P5-1-A5_TKD180702138_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed
#/usr/users/celldev/luf/test/atac/3.bampe/P5-2-B9_TKD180702139_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed
#/usr/users/celldev/luf/test/atac/3.bampe/P5-3-B10_TKD180702140_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed
CONSchr=/usr/users/celldev/luf/test/atac/5.less/paragon/$OutPrefix.3DL.consensus.bed
CONSctg=/usr/users/celldev/luf/test/atac/5.less/paragon/$OutPrefix.ctg.consensus.bed
CONStri=/usr/users/celldev/luf/test/atac/5.less/paragon/$OutPrefix.non3DL.consensus.bed
grep ^'chr' $pairbed | sort -k1,1V -k2,2n -k3,3n > $OutBase.3DL.bedpe
grep ^'ctg' $pairbed | sort -k1,1V -k2,2n -k3,3n > $OutBase.ctg.bedpe
grep -v ^'c' $pairbed | sort -k1,1V -k2,2n -k3,3n > $OutBase.non3DL.bedpe
bedtools intersect -a $OutBase.3DL.bedpe -b $CONSchr -wa -u -sorted > $OutBase.3DL.consensus.bedpe
bedtools intersect -a $OutBase.ctg.bedpe -b $CONSctg -wa -u -sorted > $OutBase.ctg.consensus.bedpe
bedtools intersect -a $OutBase.non3DL.bedpe -b $CONStri -wa -u -sorted > $OutBase.non3DL.consensus.bedpe
wc -l $OutBase.3DL.consensus.bedpe $OutBase.ctg.consensus.bedpe $OutBase.non3DL.consensus.bedpe
cat $OutBase.3DL.consensus.bedpe $OutBase.ctg.consensus.bedpe $OutBase.non3DL.consensus.bedpe > $OutBase.consensus.bedpe
perl -lane 'print $F[2]-$F[1];' $OutBase.consensus.bedpe > $OutBase.consensus.bedpe.insertsize
SizeCollectBin_luf.pl $OutBase.consensus.bedpe.insertsize 1 > $OutBase.consensus.bedpe.insertsize.bin
gedit $OutBase.consensus.bedpe.insertsize.bin
EOM2

### collect fragment size of paragon
declare -a AllLib=("/usr/users/celldev/luf/test/atac/3.bampe/P25-1-A2_TKD180702135_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/P25-2-A3_TKD180702136_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/P25-3-B4_TKD180702137_merge.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/P5-1-A5_TKD180702138_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/P5-2-B9_TKD180702139_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/P5-3-B10_TKD180702140_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.namesort.bam.bed")
for BedFile in ${AllLib[@]}; do Temp1=${BedFile##*/};Temp2=${Temp1%-*}; echo $Temp2; perl -lane 'print $F[2]-$F[1];' $BedFile > $Temp2.raw.insertsize; SizeCollectBin_luf.pl $Temp2.raw.insertsize 1 > $Temp2.raw.insertsize.bin; gedit $Temp2.raw.insertsize.bin; done

### collect fragment size of tauschii
declare -a AllLib=("/usr/users/celldev/luf/test/atac/3.bampe/T25-1-C1_TKD180702141_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.nmst.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/T25-2-C2_TKD180702142_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.nmst.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/T25-3-C3_TKD180702143_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.nmst.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/T5-1-C4_TKD180702144_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.nmst.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/T5-2-C5_TKD180702145_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.nmst.bam.bed" "/usr/users/celldev/luf/test/atac/3.bampe/T5-3-C6_TKD180702146_merge.bowtie.clean.sort.exc.rmdup.nmst.bam.bed")
for BedFile in ${AllLib[@]}; do Temp1=${BedFile##*/};Temp2=${Temp1%-*}; echo $Temp2; perl -lane 'print $F[2]-$F[1];' $BedFile > $Temp2.raw.insertsize; SizeCollectBin_luf.pl $Temp2.raw.insertsize 1 > $Temp2.raw.insertsize.bin; gedit $Temp2.raw.insertsize.bin; done


### get tsuashcii share peaks
grep ^'Chr' /usr/users/celldev/luf/test/atac/4.macs2/T25-1/T25-1_peaks.sorted.narrowPeak > T25-1.bed
grep ^'Chr' /usr/users/celldev/luf/test/atac/4.macs2/T25-2/T25-2_peaks.sorted.narrowPeak > T25-2.bed
grep ^'Chr' /usr/users/celldev/luf/test/atac/4.macs2/T25-3/T25-3_peaks.sorted.narrowPeak > T25-3.bed
grep ^'Chr' /usr/users/celldev/luf/test/atac/4.macs2/T25/T25_peaks.sorted.narrowPeak > T25.bed
grep ^'Chr' /usr/users/celldev/luf/test/atac/4.macs2/T5-1/T5-1_peaks.sorted.narrowPeak > T5-1.bed
grep ^'Chr' /usr/users/celldev/luf/test/atac/4.macs2/T5-2/T5-2_peaks.sorted.narrowPeak > T5-2.bed
grep ^'Chr' /usr/users/celldev/luf/test/atac/4.macs2/T5-3/T5-3_peaks.sorted.narrowPeak > T5-3.bed
grep ^'Chr' /usr/users/celldev/luf/test/atac/4.macs2/T5/T5_peaks.sorted.narrowPeak > T5.bed
grep ^'Chr' /usr/users/celldev/luf/test/atac/4.macs2/Tauschii/Tauschii_peaks.sorted.narrowPeak > Tauschii.bed



rm temp*
bedAfile=T25.bed
bedBfile=T25-1.bed
bedOut=temp1.bed
bedtools intersect -a $bedAfile -b $bedBfile -u -wa -sorted > $bedOut
bedAfile=$bedOut
bedBfile=T25-2.bed
bedOut=temp2.bed
bedtools intersect -a $bedAfile -b $bedBfile -u -wa -sorted > $bedOut
bedAfile=$bedOut
bedBfile=T25-3.bed
bedOut=T25.consensus.bed
bedtools intersect -a $bedAfile -b $bedBfile -u -wa -sorted > $bedOut
rm temp*


rm temp*
bedAfile=T5.bed
bedBfile=T5-1.bed
bedOut=temp1.bed
bedtools intersect -a $bedAfile -b $bedBfile -u -wa -sorted > $bedOut
bedAfile=$bedOut
bedBfile=T5-2.bed
bedOut=temp2.bed
bedtools intersect -a $bedAfile -b $bedBfile -u -wa -sorted > $bedOut
bedAfile=$bedOut
bedBfile=T5-3.bed
bedOut=T5.consensus.bed
bedtools intersect -a $bedAfile -b $bedBfile -u -wa -sorted > $bedOut
rm temp*


### final consensus
:<<FINALBED
/usr/users/celldev/luf/test/atac/5.less/paragon/P25.3DL.consensus.bed
/usr/users/celldev/luf/test/atac/5.less/paragon/P25.ctg.consensus.bed
/usr/users/celldev/luf/test/atac/5.less/paragon/P25.non3DL.consensus.bed
/usr/users/celldev/luf/test/atac/5.less/paragon/P5.3DL.consensus.bed
/usr/users/celldev/luf/test/atac/5.less/paragon/P5.ctg.consensus.bed
/usr/users/celldev/luf/test/atac/5.less/paragon/P5.non3DL.consensus.bed
/usr/users/celldev/luf/test/atac/5.less/tauschii/T25.consensus.bed
/usr/users/celldev/luf/test/atac/5.less/tauschii/T5.consensus.bed
FINALBED

cp /usr/users/celldev/luf/test/atac/5.less/paragon/P25.3DL.consensus.bed ./
cat /usr/users/celldev/luf/test/atac/5.less/paragon/P25.3DL.consensus.bed /usr/users/celldev/luf/test/atac/5.less/paragon/P25.ctg.consensus.bed > P25.chr3DL.consensus.bed
cp /usr/users/celldev/luf/test/atac/5.less/paragon/P5.3DL.consensus.bed ./
cat /usr/users/celldev/luf/test/atac/5.less/paragon/P5.3DL.consensus.bed /usr/users/celldev/luf/test/atac/5.less/paragon/P5.ctg.consensus.bed > P5.chr3DL.consensus.bed

grep ^'Chr3' /usr/users/celldev/luf/test/atac/5.less/tauschii/T25.consensus.bed > T25.chr3.consensus.bed

grep ^'Chr3' /usr/users/celldev/luf/test/atac/5.less/tauschii/T5.consensus.bed > T5.chr3.consensus.bed


### 6 Annotation
cd /usr/users/celldev/luf/test/atac/6.chipseeker
### 6.1 chip-seeker
Rscript plot.Rscript

gedit 
cat *annot.txt | cut -f 13 | sort -u 

Promoter (1-2kb)
Promoter (<=1kb)
3' UTR
5' UTR
annotation
Distal Intergenic
Downstream (1-2kb)
Downstream (<1kb)
Downstream (2-3kb)
Exon
Intron

### 6.2 homer

awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' /usr/users/celldev/luf/test/atac/6.chipseeker/P5.chr3DL.consensus.bed > P5.bed

annotatePeaks.pl P5.bed /usr/users/celldev/luf/database/chr3DL.BAC.pseudomolecule.Uscaff.20181101.fa -gff3 /usr/users/celldev/luf/test/atac/6.chipseeker/paragon.sorted.gff > P5.annotation.txt
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' /usr/users/celldev/luf/test/atac/6.chipseeker/T5.chr3.consensus.bed > T5.bed
annotatePeaks.pl T5.bed /usr/users/celldev/luf/database/Aet_pseudomolecules_v0.1.chr3only.fa -gff3 /usr/users/celldev/luf/test/atac/6.chipseeker/AL878.gff3 > T5.annotation.txt

cd /usr/users/celldev/luf/test/atac/7.fragments
BinSize=5


for indpeakrange in `ls *fil.frag`; do 	SizeCollectBin_luf.pl $indpeakrange $BinSize > $indpeakrange.bin$BinSize; done
list_merger.pl P5.peakrange.sum 0 P5.temp.CDS.fil.frag.bin$BinSize P5.temp.Intergenic.fil.frag.bin$BinSize P5.temp.UTR3downstream.fil.frag.bin$BinSize P5.temp.UTR5promoter.fil.frag.bin$BinSize
list_merger.pl T5.peakrange.sum 0 T5.temp.CDS.fil.frag.bin$BinSize T5.temp.Intergenic.fil.frag.bin$BinSize T5.temp.UTR3downstream.fil.frag.bin$BinSize T5.temp.UTR5promoter.fil.frag.bin$BinSize


BinSize=40
for indpeakrange in `ls *peakrange`; do 	SizeCollectBin_luf.pl $indpeakrange $BinSize > $indpeakrange.bin$BinSize; done
list_merger.pl P25.peakrange.sum 0 P25.temp.CDS.peakrange.bin$BinSize P25.temp.Intergenic.peakrange.bin$BinSize P25.temp.UTR3downstream.peakrange.bin$BinSize P25.temp.UTR5promoter.peakrange.bin$BinSize

list_merger.pl P5.peakrange.sum 0 P5.temp.CDS.peakrange.bin$BinSize P5.temp.Intergenic.peakrange.bin$BinSize P5.temp.UTR3downstream.peakrange.bin$BinSize P5.temp.UTR5promoter.peakrange.bin$BinSize

list_merger.pl T25.peakrange.sum 0 T25.temp.CDS.peakrange.bin$BinSize T25.temp.Intergenic.peakrange.bin$BinSize T25.temp.UTR3downstream.peakrange.bin$BinSize T25.temp.UTR5promoter.peakrange.bin$BinSize

list_merger.pl T5.peakrange.sum 0 T5.temp.CDS.peakrange.bin$BinSize T5.temp.Intergenic.peakrange.bin$BinSize T5.temp.UTR3downstream.peakrange.bin$BinSize T5.temp.UTR5promoter.peakrange.bin$BinSize




### extract chr3DL chromatin state
cd /usr/users/celldev/luf/test/atac/0.chromatin_state
gff3_extract_chromatin_state.pl /usr/users/celldev/luf/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180709.yml.rename2.gff3 /usr/users/celldev/luf/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa chr3DL
bedtools merge -i chr3DL.Promoter2000.bed > chr3DL.merge.Promoter2000.merged.bed
cat  chr3DL.UTR5.bed chr3DL.Promoter2000.bed | sort -k1,1V -k2,2n -k3,3n > chr3DL.merge.UTR5promoter.bed
bedtools merge -i chr3DL.merge.UTR5promoter.bed > chr3DL.merge.UTR5promoter.merged.bed

cat  chr3DL.UTR3.bed chr3DL.downstream2000.bed | sort -k1,1V -k2,2n -k3,3n > chr3DL.merge.UTR3downstream.bed
bedtools merge -i chr3DL.merge.UTR3downstream.bed > chr3DL.merge.UTR3downstream.merged.bed
bedtools merge -i chr3DL.GENEBODY.bed > chr3DL.merge.genebody.merged.bed
perl -e 'print "chr3DL_pseudomolecule\t0\t371759578\n"' > chr3DL.bed
bedtools subtract -a chr3DL.bed -b chr3DL.merge.genebody.merged.bed > temp1.bed
bedtools subtract -a temp1.bed -b chr3DL.merge.UTR3downstream.merged.bed > temp2.bed
bedtools subtract -a temp2.bed -b chr3DL.merge.UTR5promoter.merged.bed > chr3DL.merge.intergenic.merged.bed
rm temp*bed
perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' chr3DL.merge.UTR3downstream.merged.bed
perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR5 ", $sum, "\n";}' chr3DL.merge.UTR5promoter.merged.bed
perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "genebody ", $sum, "\n";}' chr3DL.merge.genebody.merged.bed
perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "intergenic ", $sum, "\n";}' chr3DL.merge.intergenic.merged.bed

### Extract chr3L chromatin state
gff3_extract_chromatin_state.pl /usr/users/celldev/luf/database/AET_PGSB_v2_Dez2015.gtf_chr3L_final.20170826rev.rename.wheat.20180705.UTR.rename2.gff3 /usr/users/celldev/luf/database/Aet_pseudomolecules_v0.1.chr3only.fa chr3L

cat  chr3L.UTR5.bed chr3L.Promoter2000.bed | sort -k1,1V -k2,2n -k3,3n > chr3L.merge.UTR5promoter.bed
bedtools merge -i chr3L.merge.UTR5promoter.bed > chr3L.merge.UTR5promoter.merged.bed
bedtools merge -i chr3L.Promoter2000.bed > chr3L.merge.Promoter2000.merged.bed
cat  chr3L.UTR3.bed chr3L.downstream2000.bed | sort -k1,1V -k2,2n -k3,3n > chr3L.merge.UTR3downstream.bed
bedtools merge -i chr3L.merge.UTR3downstream.bed > chr3L.merge.UTR3downstream.merged.bed
bedtools merge -i chr3L.GENEBODY.bed > chr3L.merge.genebody.merged.bed
perl -e 'print "Chr3\t249873855\t627182665\n"' > chr3L.bed
bedtools subtract -a chr3L.bed -b chr3L.merge.genebody.merged.bed -sorted > temp1.bed
bedtools subtract -a temp1.bed -b chr3L.merge.UTR3downstream.merged.bed -sorted > temp2.bed
bedtools subtract -a temp2.bed -b chr3L.merge.UTR5promoter.merged.bed -sorted > chr3L.merge.intergenic.merged.bed
rm temp*bed
perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' chr3L.merge.UTR3downstream.merged.bed
perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR5 ", $sum, "\n";}' chr3L.merge.UTR5promoter.merged.bed
perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "genebody ", $sum, "\n";}' chr3L.merge.genebody.merged.bed
perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "intergenic ", $sum, "\n";}' chr3L.merge.intergenic.merged.bed


cd /usr/users/celldev/luf/test/atac/7.fragments
perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' P25.temp.CDS
#UTR3 18639

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' P5.temp.CDS
#23652

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' P25.temp.Intergenic
#847630

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' P5.temp.Intergenic
#938240

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' P25.temp.UTR3downstream
#117904

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' P5.temp.UTR3downstream
#130049

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' P25.temp.UTR5promoter
#719671

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' P5.temp.UTR5promoter
#811025


perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' T25.temp.CDS
#79087

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' T5.temp.CDS
#112196

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' T25.temp.Intergenic
#1323852

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' T5.temp.Intergenic
#1910670

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' T25.temp.UTR3downstream
#236328

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' T5.temp.UTR3downstream
#405646

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' T25.temp.UTR5promoter
#860951

perl -lane 'BEGIN{$sum=0;} $len=$F[2]-$F[1]; $sum+=$len; END{print "UTR3 ", $sum, "\n";}' T5.temp.UTR5promoter
#1381377
###make plot
./heatmaps_in_r.Rscript P5 0.0005
./heatmaps_in_r.Rscript T5 0.0012





### making promoter plot
cd /usr/users/celldev/luf/test/atac/8.heatplot
./heatmaps_in_r.Rscript P25 0.0005
./heatmaps_in_r.Rscript T25 0.0005
./heatmaps_in_r.Rscript P5 0.0005
./heatmaps_in_r.Rscript T5 0.0012


cd /usr/users/celldev/luf/test/atac/9.peaklen
./heatmaps_in_r.Rscript UTR5promoter 0.03
./heatmaps_in_r.Rscript UTR3downstream 0.0051
./heatmaps_in_r.Rscript intergenic 0.03
./heatmaps_in_r.Rscript CDS 0.0024


### 20181002 motif HOMER
mkdir -p P5 T5
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' /usr/users/celldev/luf/test/atac/5.less/paragon/P5.3DL.consensus.bed > P5.3DL.bed
findMotifsGenome.pl P5.3DL.bed ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa P5


awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' /usr/users/celldev/luf/test/atac/6.chipseeker/T5.chr3.consensus.bed > T5.chr3.bed
findMotifsGenome.pl T5.chr3.bed /usr/users/celldev/luf/database/Aet_pseudomolecules_v0.1.chr3only.fa T5
### Get Chr3L long arm as HOMER call backgroud P value
#Chr3:249873855-627182665
samtools faidx /usr/users/celldev/luf/database/Aet_pseudomolecules_v0.1.chr3only.fa Chr3:249873855-627182665 > chr3L.fa
perl -lane 'print $F[3], "\t", $F[0], "\t", $F[1]-249873854, "\t", $F[2]-249873854, "\t+", ' /usr/users/celldev/luf/test/atac/6.chipseeker/T5.chr3.consensus.bed > T5.chr3L.bed
mkdir T5L
findMotifsGenome.pl T5.chr3L.bed chr3L.fa T5L

###R
install.packages("tidyverse")
require(readxl)
require(purrr)
require(magrittr)
require(tidyverse)
x <- read_xlsx("data.xlsx")
x
y <- map_df(seq(1, length(x), 2), function(i) {
    res <- x[,i:(i+1)]
    names(res) <- c("motif", "pvalue")
    res[[2]] %<>% as.numeric
    res$type = names(x)[i]
    res <- res[!is.na(res$motif),]
    res
})

y$type = factor(y$type, levels=names(x)[seq(1, length(x), 2)])

y


library(ggplot2)
ggplot(y, aes(type, motif)) + 
    geom_point(aes(size=-log(pvalue))) + 
    theme_minimal() + 
    xlab(NULL) + ylab(NULL) + 
    scale_size_continuous(range=c(1, 10))
    
    
    
### relationship to expression
cd /usr/users/celldev/luf/test/atac/11.atac_vs_expression
cut -f 19 ../7.fragments/P5.temp.CDS | sort -u > P5.temp.CDS.gene
cut -f 19 ../7.fragments/T5.temp.CDS | sort -u > T5.temp.CDS.gene
cut -f 19 ../7.fragments/P5.temp.UTR5promoter | sort -u > P5.temp.UTR5promoter.gene
cut -f 19 ../7.fragments/T5.temp.UTR5promoter | sort -u > T5.temp.UTR5promoter.gene
cut -f 19 ../7.fragments/P5.temp.UTR3downstream | sort -u > P5.temp.UTR3downstream.gene
cut -f 19 ../7.fragments/T5.temp.UTR3downstream | sort -u > T5.temp.UTR3downstream.gene

cat P5* | sort -u | wc -l
cat T5* | sort -u | wc -l


library("scatterplot3d")
x <- read.table("data", header=TRUE, sep="\t")
head(x)
scatterplot3d(x[,1:3])

colors <- c("#0000FF", "#FF0000")
colors <- colors[as.numeric(x$DEG)]
setEPS()
postscript("UTR3.eps", width=10, height=8, pointsize=10)
scatterplot3d(x[,1:3], pch = 16, color=x$DEG)
dev.off()

x <- read.table("UTR5.data", header=TRUE, sep="\t")
head(x)
setEPS()
postscript("UTR5.eps", width=10, height=8, pointsize=10)
scatterplot3d(x[,1:3], pch = 16, color=x$DEG)
dev.off()



BinSize=2
PfxData="CDS"
PfxData="UTR3"
PfxData="UTR5"
gedit $PfxData.0.data $PfxData.1.data $PfxData.-1.data $PfxData.2.data
SizeCollectBin_luf.pl $PfxData.0.data $BinSize > $PfxData.0.data.bin$BinSize
SizeCollectBin_luf.pl $PfxData.1.data $BinSize > $PfxData.1.data.bin$BinSize
SizeCollectBin_luf.pl $PfxData.-1.data $BinSize > $PfxData.-1.data.bin$BinSize
SizeCollectBin_luf.pl $PfxData.2.data $BinSize > $PfxData.2.data.bin$BinSize
gedit $PfxData.*.bin$BinSize
gedit $PfxData.DEG.heatplot.data

cd /usr/users/celldev/luf/test/atac/11.atac_vs_expression/heatplot
./heatplot.rscript CDS.DEG.heatplot.data 0.52 CDS.DEG.heatplot.data.eps
./heatplot.rscript UTR3.DEG.heatplot.data 0.45 UTR3.DEG.heatplot.data.eps
./heatplot.rscript UTR5.DEG.heatplot.data 0.23 UTR5.DEG.heatplot.data.eps



cd /usr/users/celldev/luf/test/atac/9.peaklen
/usr/users/celldev/luf/test/atac/7.fragments/P5.temp.CDS
/usr/users/celldev/luf/test/atac/7.fragments/T5.temp.CDS
/usr/users/celldev/luf/test/atac/7.fragments/P5.temp.Intergenic
/usr/users/celldev/luf/test/atac/7.fragments/T5.temp.Intergenic
/usr/users/celldev/luf/test/atac/7.fragments/P5.temp.UTR3downstream
/usr/users/celldev/luf/test/atac/7.fragments/T5.temp.UTR3downstream
/usr/users/celldev/luf/test/atac/7.fragments/P5.temp.UTR5promoter 
/usr/users/celldev/luf/test/atac/7.fragments/T5.temp.UTR5promoter

###test 
perl -lne '@F=split(/\t/); print $F[18], "\t", $F[1], "\t", $F[2]; $dist=$F[2]-$F[1]; $hash{$F[18]}+=$dist; END {foreach $x (sort keys %hash) {print $x, "\t", $hash{$x};}}' /usr/users/celldev/luf/test/atac/7.fragments/P5.temp.CDS > P5.temp.CDS.open.len



perl -lne '@F=split(/\t/); $dist=$F[2]-$F[1]; $hash{$F[18]}+=$dist; END {foreach $x (sort keys %hash) {print $x, "\t", $hash{$x};}}' /usr/users/celldev/luf/test/atac/7.fragments/P5.temp.CDS > P5.temp.CDS.open.len
perl -lne '@F=split(/\t/); $dist=$F[2]-$F[1]; $hash{$F[18]}+=$dist; END {foreach $x (sort keys %hash) {print $x, "\t", $hash{$x};}}' /usr/users/celldev/luf/test/atac/7.fragments/T5.temp.CDS > T5.temp.CDS.open.len
perl -lne '@F=split(/\t/); $dist=$F[2]-$F[1]; $hash{$F[18]}+=$dist; END {foreach $x (sort keys %hash) {print $x, "\t", $hash{$x};}}' /usr/users/celldev/luf/test/atac/7.fragments/P5.temp.UTR3downstream > P5.temp.UTR3downstream.open.len
perl -lne '@F=split(/\t/); $dist=$F[2]-$F[1]; $hash{$F[18]}+=$dist; END {foreach $x (sort keys %hash) {print $x, "\t", $hash{$x};}}' /usr/users/celldev/luf/test/atac/7.fragments/T5.temp.UTR3downstream > T5.temp.UTR3downstream.open.len
perl -lne '@F=split(/\t/); $dist=$F[2]-$F[1]; $hash{$F[18]}+=$dist; END {foreach $x (sort keys %hash) {print $x, "\t", $hash{$x};}}' /usr/users/celldev/luf/test/atac/7.fragments/P5.temp.UTR5promoter > P5.temp.UTR5promoter.open.len
perl -lne '@F=split(/\t/); $dist=$F[2]-$F[1]; $hash{$F[18]}+=$dist; END {foreach $x (sort keys %hash) {print $x, "\t", $hash{$x};}}' /usr/users/celldev/luf/test/atac/7.fragments/T5.temp.UTR5promoter > T5.temp.UTR5promoter.open.len

grep -P "\tgene\t" /usr/users/celldev/luf/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180709.yml.rename2.gff3 | perl -lne '@F=split(/\t/); $F[8]=~s/^.*ID=//;$F[8]=~s/;.*$//;print $F[8], "\t", $F[3];' | sort -k2,2n > chrom.pos

./peak_len_class.R CDS.DEG.data 'CDS peak length in DEGs'
./peak_len_class.R UTR3.DEG.data 'UTR3 peak length in DEGs'
./peak_len_class.R UTR5.DEG.data 'Differential Expressed Genes' Fig.4C.UTR5.peak.legnth.chrom.DEG.tif

./peak_len_class.R  CDS.balanced.data 'CDS peak length in balanced genes'
./peak_len_class.R  UTR3.balanced.data 'UTR3 peak length in balanced genes' 
./peak_len_class.R  UTR5.balanced.data 'Balanced Genes' Fig.4C.UTR5.peak.legnth.chrom.balanced.tif




for bamfile in "P5-1-A5_TKD180702138_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam" "P5-2-B9_TKD180702139_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam" "P5-3-B10_TKD180702140_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam" "P-Nk-C9_TKD180702147_HNCLHCCXY_L1.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam" "P-Nk-C9_TKD180702147_HNCLHCCXY_L1.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam" "T5-1-C4_TKD180702144_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.bam" "T5-2-C5_TKD180702145_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.bam" "T5-3-C6_TKD180702146_merge.bowtie.clean.sort.exc.rmdup.bam" "T-Nk-C11_TKD180702148_HNCLHCCXY_L1.bowtie.clean.sort.exc.rmdup.bam"; do echo "$bamfile"; bamCoverage -b $bamfile -o $bamfile.bw -bs=1 -p=max; done


bamCoverage -b P5-1-A5_TKD180702138_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam -o P5-1-A5_TKD180702138_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam.bw -bs=1 -p=max

wigToBigWig

wigToBigWig P5-1-A5_TKD180702138_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam.wig ../../scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fai P5-1-A5_TKD180702138_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam.wig.bw
wigToBigWig P5-2-B9_TKD180702139_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam.wig
wigToBigWig P5-3-B10_TKD180702140_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam.wig
wigToBigWig P-Nk-C9_TKD180702147_HNCLHCCXY_L1.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam.wig
wigToBigWig T5-1-C4_TKD180702144_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.bam.wig
wigToBigWig T5-2-C5_TKD180702145_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.bam.wig
wigToBigWig T5-3-C6_TKD180702146_merge.bowtie.clean.sort.exc.rmdup.bam.wig
wigToBigWig T-Nk-C11_TKD180702148_HNCLHCCXY_L1.bowtie.clean.sort.exc.rmdup.bam.wig

bam2bigwig.sh -i ../P5-1-A5_TKD180702138_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam -r chr3DL_pseudomolecule -o P5-1.bw -fai ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa.fai
bam2bigwig.sh -i ../P5-2-B9_TKD180702139_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam -r chr3DL_pseudomolecule -o P5-2.bw -fai ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa.fai
bam2bigwig.sh -i ../P5-3-B10_TKD180702140_HNFCCCCXY_L3.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam -r chr3DL_pseudomolecule -o P5-3.bw -fai ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa.fai
bam2bigwig.sh -i ../P-Nk-C9_TKD180702147_HNCLHCCXY_L1.bowtie.clean.sort.exc.reheader.rmdup.uniqmapping.bam -r chr3DL_pseudomolecule -o P-Nk.bw -fai ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa.fai

bam2bigwig.sh -i ../T5-1-C4_TKD180702144_HNFCCCCXY_L3.bowtie.clean.sort.exc.rmdup.bam -r Chr3 -o T5-1.bw -fai ~/database/Aet_pseudomolecules_v0.1.chr3only.fa.fai

cd /usr/users/celldev/luf/test/atac/9.peaklen/peak_len_VS_DEG
library(rgl)
x = read.table("DEG.data", header=TRUE, sep="\t")
x = plot3d(x$pUTR5, x$tUTR5, fold)



#### mpact of CDS and UTR3 alone on DEG is minimal; 
cd /usr/users/celldev/luf/test/atac/9.peaklen/peak_len_VS_DEG
library(rgl)
x = read.table("DEG.data2", header=TRUE, sep="\t")
color.codes=c("red", "blue", "grey")
x = plot3d(x$pCODE, x$tCODE, fold, col=as.integer(x$group))


cd /usr/users/celldev/luf/test/atac/9.peaklen/peak_len_VS_DEG
./leaf.exp.R




#####
cd /usr/users/celldev/luf/test/atac/10.motif/updown
perl updown2peak.pl updownlist updown


#Total IDS: 248
#Total Paragon IDs: 248
#Total Taushchii IDs: 248
#Paragon input lines: 1266
#Paragon out lines: 144
#Tauschii input lines: 1739
#Tauschii out lines: 189
mkdir P5 T5
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' updown.paragon.peak > P5.bed
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' updown.tauschii.peak > T5.bed
findMotifsGenome.pl P5.bed ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa P5
findMotifsGenome.pl T5.bed /usr/users/celldev/luf/database/Aet_pseudomolecules_v0.1.chr3only.fa T5
cd /usr/users/celldev/luf/test/atac/10.motif/UP
perl ../updown/updown2peak.pl uplist up
#Total IDS: 106
#Total Paragon IDs: 106
#Total Taushchii IDs: 106
#Paragon input lines: 1266
#Paragon out lines: 74
#Tauschii input lines: 1739
#Tauschii out lines: 116
mkdir P5 T5
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' up.paragon.peak > P5.bed
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' up.tauschii.peak > T5.bed
findMotifsGenome.pl P5.bed ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa P5
findMotifsGenome.pl T5.bed /usr/users/celldev/luf/database/Aet_pseudomolecules_v0.1.chr3only.fa T5
cd /usr/users/celldev/luf/test/atac/10.motif/DOWN
perl ../updown/updown2peak.pl downlist down
#Total IDS: 142
#Total Paragon IDs: 142
#Total Taushchii IDs: 142
#Paragon input lines: 1266
#Paragon out lines: 70
#Tauschii input lines: 1739
#Tauschii out lines: 73
mkdir P5 T5
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' down.paragon.peak > P5.bed
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' down.tauschii.peak > T5.bed
findMotifsGenome.pl P5.bed ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa P5
findMotifsGenome.pl T5.bed /usr/users/celldev/luf/database/Aet_pseudomolecules_v0.1.chr3only.fa T5

--------------------------------------------------------------


cd /usr/users/celldev/luf/test/atac/12.intergenic
cut -f 1,2,3 ../7.fragments/P5.temp.Intergenic > P5.intergenic.bed
bedtools intersect -a ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.mask.gff3 -b P5.intergenic.bed -wa -u > P5.intergenic.bed.repeat.gff3

bedtools intersect -a P5.intergenic.bed -b ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.mask.gff3 -wa -u | wc -l
bedtools intersect -a P5.intergenic.bed -b ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.mask.gff3 -wo > P5.intergenic.bed.repeat.gff3

cut -f 1,2,3 ../7.fragments/T5.temp.Intergenic > T5.intergenic.bed
bedtools intersect -a ~/database/Aet_pseudomolecules_v0.1.chr3only.mask.gff3 -b T5.intergenic.bed -wa -u -sorted > T5.intergenic.bed.repeat.gff3

bedtools intersect -a T5.intergenic.bed -b ~/database/Aet_pseudomolecules_v0.1.chr3only.mask.gff3 -wa -u -sorted > T5.intergenic.bed.repeat.gff3

bedtools intersect -a T5.intergenic.bed -b ~/database/Aet_pseudomolecules_v0.1.chr3only.mask.gff3 -wa -u -sorted | wc -l
bedtools intersect -a T5.intergenic.bed -b ~/database/Aet_pseudomolecules_v0.1.chr3only.mask.gff3 -wo -sorted > T5.intergenic.bed.repeat.gff3

   1425 P5.intergenic.bed
    501 P5.intergenic.bed.repeat.gff3
 109726 repeat.id
   2570 T5.intergenic.bed
    999 T5.intergenic.bed.repeat.gff3
    

OutPfx="P5_all"
mkcd /usr/users/celldev/luf/test/atac/12.intergenic/$OutPfx
mkdir $OutPfx
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' /usr/users/celldev/luf/test/atac/7.fragments/P5.temp.Intergenic > $OutPfx.bed
findMotifsGenome.pl $OutPfx.bed ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa $OutPfx

OutPfx="P5_repeats"
mkcd /usr/users/celldev/luf/test/atac/12.intergenic/$OutPfx
mkdir $OutPfx
bedtools intersect -a /usr/users/celldev/luf/test/atac/7.fragments/P5.temp.Intergenic -b ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.mask.gff3 -wa -u > $OutPfx.intergenic
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' $OutPfx.intergenic > $OutPfx.bed
findMotifsGenome.pl $OutPfx.bed ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa $OutPfx
OutPfx="P5_unknown"
mkcd /usr/users/celldev/luf/test/atac/12.intergenic/$OutPfx
mkdir $OutPfx
bedtools intersect -a /usr/users/celldev/luf/test/atac/7.fragments/P5.temp.Intergenic -b ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.mask.gff3 -wa -v > $OutPfx.intergenic
awk '{print $4"\t"$1"\t"$2"\t"$3"\t+"}' $OutPfx.intergenic > $OutPfx.bed
findMotifsGenome.pl $OutPfx.bed ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa $OutPfx



cd /usr/users/celldev/luf/test/atac/6.chipseeker
tail -n +2 P5.annot.txt | perl -lne '@F=split(/\t/); print if ($F[6]>10000);'

tail -n +2 T5.annot.txt | perl -lne '@F=split(/\t/); print if ($F[6]>10000);'

tail -n +2 T5.annot.txt | perl -lne '@F=split(/\t/); print if ($F[6]>10000);'





getfasta -fi ~/test/scaffolding/final/chr3DL.Triticum3.1.pseudomolecule.20180401.yml.fa -bed P5.bed  -fo P5.fasta -name+

bedtools getfasta -fi ~/database/Aet_pseudomolecules_v0.1.chr3only.fa -bed T5.bed  -fo T5.fasta -name+

### summarize repeatmasker out
BedIn="chr3DL.Triticum3.1.scaffolds.after.quickmerge.20180401.w70.uc.fa.out"
BedIn="chr3L.fa.out"
OutPfx="SUM"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;print;' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3 > 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'

OutPfx="DNA"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^DNA/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'

OutPfx="DNA-En-Spm"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^DNA\/En-Spm/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="LINE"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^LINE/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="Low_complexity"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^Low_complexity/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'

OutPfx="LTR"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^LTR/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="LTR-Copia"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^LTR\/Copia/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="LTR-Gypsy"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^LTR\/Gypsy/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="MobileElement"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^MobileElement/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="Other"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^Other/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="RC"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^RC/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="rRNA"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^rRNA/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="Simple_repeat"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^Simple_repeat/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'
OutPfx="SINE"
grep -v 'SW   perc perc perc\|score   div. del. ins\|^$' $BedIn |    awk '{print $5,"\t",$6-1,"\t",$7,"\t",$11}' | perl -lne 's/ //g;@F=split(/\t/);print if($F[3]=~/^SINE/);' | sort -k1,1 -k2,2n -k3,3n| cut -f 1,2,3  | perl -lne 's/ //g;print;'> 0.$OutPfx.bed
bedtools merge -i 0.$OutPfx.bed | perl -lane '$sum=$sum+$F[2]-$F[1];END {print $sum;}'

